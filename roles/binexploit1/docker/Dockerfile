FROM ubuntu:18.04

RUN apt-get update && apt-get install -y binutils socat
RUN useradd -m -d /home/jack jack
RUN echo 'jack:theBeanStalk123!' | chpasswd
RUN usermod -s /bin/bash jack

# SSH login fix. Otherwise user is kicked off after login
#RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd
ENV NOTVISIBLE "in users profile"
RUN echo "export VISIBLE=now" >> /etc/profile

EXPOSE 9001
#CMD ["exec", "/usr/bin/socat", "tcp4-listen:9001,fork,reuseaddr", "exec:/home/jack/bin0"]

COPY --chown=jack:jack bin0 /home/jack/bin0
RUN chmod 755 /home/jack/bin0
RUN echo "flag{bUFf3R_OverFL0wz_AR3_e4zY}" >> /home/jack/flag.txt
RUN chmod 644 /home/jack/flag.txt